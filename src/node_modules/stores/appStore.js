'use strict';

var _ = require('lodash');

var {EventEmitter} = require('events');
var appDispatcher = require('dispatcher');

var data = {
  messages: []
};


var appStore = _.extend({}, EventEmitter.prototype, {
  getMessages() {
    return data.messages;
  },
  getData() { return data; },
  setData(d) { data = d; },
  addListener(eventName, callback) {
    this.on(eventName, callback);
  },
  emitChange() {
    this.emit('change');
  }
});

appDispatcher.register((payload) => {
  var action = payload.action;

  switch(payload.action.type) {
    case 'SEND_CHAT_MESSAGE':
      data.messages.push(payload.action.data);
      break;

    default:
      return;
  }

  appStore.emitChange();
});

module.exports = appStore;
