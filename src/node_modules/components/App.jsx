'use strict';

var React = require('react');

var appStore = require('stores/appStore');
var MessageBox = require('components/MessageBox');
var chatActions = require('actionCreators/chatActions');

function getState() {
  return {
    messages: appStore.getMessages()
  };
}

module.exports = React.createClass({
  render: function(){
    return (
      <div>
        <h1>Hello World</h1>
        <ul>
          {this.state.messages.map((message) =>
            <li>{message}</li>)}
        </ul>
        <MessageBox onSubmit={this.submitMessage} />
      </div>
    )
  },
  submitMessage(message) {
    chatActions.sendMessage(message);
  },
  onChange() {
    this.setState(getState());
  },
  getInitialState: getState,
  componentDidMount() {
    appStore.addListener('change', this.onChange);
  },
  componentWillUnmount() {
    appStore.removeListener('change', this.onChange);
  }
});

